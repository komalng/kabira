<div class="col-12">
</div>

<div class="contents">
  {{#each videos}}
  <div class="col-md-4 quarter card text-center" style="border: none;">
    <div style="position: relative;" id="{{this.video_id}}">
      <div onclick="playVideoCustom('{{this.video_id}}')">
        <img class="card-img-top img-fluid" src="https://img.youtube.com/vi/{{this.video_id}}/mqdefault.jpg">
        <img src="{{root}}assets/img/playicon.png" class="playicon" />
      </div>
    </div>
    <div class="card-body" style="background-color: #eee;">
      <p class="card-text">
        {{this.description}}
      </p>
    </div>
  </div>
  {{/each}}
</div>

<script src="//www.youtube.com/iframe_api"></script>

<script>
  // https://developers.google.com/youtube/iframe_api_reference

  var player, timer, video_id;

  function playVideoCustom(vid) {
    $('.card iframe').each((index, value)=>{
      var v_id = value.id;
      var new_html = `<div style="position: relative;" id="`+v_id+`">
        <div onclick="playVideoCustom('`+v_id+`')">
          <img class="card-img-top img-fluid" src="https://img.youtube.com/vi/`+v_id+`/mqdefault.jpg">
          <img src="{{root}}assets/img/playicon.png" class="playicon" />
        </div>
      </div>` + $('#'+v_id).parent().children(":nth-child(2)")[0].outerHTML;
      $('#'+v_id).parent().html(new_html);
    });

    video_id = vid;
    player = new YT.Player(video_id, {
      height: $('#zRuOAjnY5aQ').height(),
      width: $('#zRuOAjnY5aQ').width(),
      videoId: video_id,
      playerVars: {
        autoplay: 1,
        origin: window.location.origin,
        autohide: 1,
        host: `${window.location.protocol}//www.youtube.com`
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function myTimer(target) {
    target.playVideo();
  }

  function onPlayerReady(event) {
    event.target.setVolume(100);
    timer = setInterval(myTimer, 2000, event.target);
  }

  function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
      clearInterval(timer);
      console.log("cleared interval");
    };

    if (event.data == YT.PlayerState.ENDED) {
      if ($('#'+video_id).parent().next().html()) {
        video_id = $('#'+video_id).parent().next().children(":first").attr('id');
      } else {
        video_id = $('#Cnm7NQTtFag').parent().parent().children(":first").children(":first").attr('id');
      }
      // player.loadVideoById(video_id);
      playVideoCustom(video_id)
    }

    //     // currentVideoId++;
    //     // change it
    //     if (currentVideoId < videoIDs.length) {
    //         player.loadVideoById(currentVideoId);
    //     }
    // }
  }
</script>